import numpy
import pandas
import statsmodels.api as sm
import matplotlib.pyplot as plt

num_hour=9
num_days=92

hourly_data=[96.25,195.625,119.375,103.125,100,90,93.3333333,78.75,58.75,84.4444444,91.1111111,116.875,103.125,103.5,99.375,92.5,78.75,88.75,90,82.7777778,81.875,93.75,94.375,98.3333333,109.375,98.3333333,120,117.5,118.125,119.444444,146.25,131.5,123.75,142.5,141,140,117.5,78.75,118.125,117.5,108.75,125.555556,108.125,98.75,85,69.4444444,86.6666667,103.888889,95.625,103.571429,96.25,105,103.75,81.6666667,75,144.375,119.545455,130.555556,123.125,105,85,101,103.125,112.142857,151.666667,136.25,130.625,138.75,130,118.75,125,113.888889,112.5,104.090909,119.375,140.625,120.625,126.666667,126.875,110,104.166667,125,132.5,120.625,112.5,117.5,116.25,126.875,107.5,96.25,84.4444444,111.875,112.5,97.5,112.5,124.5,106.25,127,117.222222,110,116.111111,102.777778,93.8888889,101.666667,95.625,113.75,112.5,102.5,99.375,111.5,114.375,108.125,135.555556,120,130.625,125.555556,117.5,80.5555556,79.375,85,101.875,110,93.75,106.111111,103.333333,130,90.625,99.375,113.125,106.875,142.5,135,135,120,135,91.25,120.625,112.5,113.125,112.5,105,88.125,92.5,95,88.75,114.375,110.625,102.5,113.75,104.375,109.375,113.75,109.285714,91.6666667,107.5,115.625,112.5,122.142857,125,120,126.875,131.25,107.5,102.777778,93.75,102.5,103.125,101.25,125.555556,90,91.5,93.75,115.625,108.75,101.25,101.875,95,119.375,135,116.666667,84.375,80.7142857,101.875,126.875,110,107.5,105,107.5,106.875,109.375,96.25,125,139.375,131.25,130,106.25,121.25,120,119.285714,118.125,121.875,120,123.888889,110.833333,119.166667,117.142857,120,92.2222222,127.5,106.666667,136.875,135.625,130,137.5,136.875,106.428571,96.6666667,95,104.375,140.625,121.875,118.125,102.222222,120,113.75,85.625,111.25,120.714286,135,116.875,115,115,114.375,135,101.25,100,105,108.75,101.875,98.75,109.375,105.625,112.142857,92.2222222,120.625,105,100.625,117.857143,101.25,93.5714286,101.25,92.5,86.875,118.125,123.125,141.875,135,135,127.5,112.857143,75,106.666667,117.5,123.571429,141.875,133.125,118.125,123.125,108.125,120,115.625,110,129.375,123.75,111.25,103.75,125.625,98.125,112.5,111.111111,137.777778,114.444444,98.125,105.625,111.25,101.25,102.142857,96.25,103.125,110,115.714286,111.666667,130,116.333333,101.25,95,88.8888889,78.3333333,98.5,111.875,103.125,98.5714286,111.875,117.142857,119.375,114.285714,114.5,103.75,118.75,115,112.5,100,95,115,106.25,117.777778,98.75,112.777778,126.25,131.25,120.625,125,111.666667,111,93.125,95,103.75,115,117,122.222222,118.571429,131.25,107.5,108.75,118.125,115.625,125.555556,121.25,108,99,90,106.875,107.777778,100.555556,110,100.625,98.125,98.75,104.285714,92.1428571,98.125,97.1428571,114,113.125,123.571429,107.5,101.25,132.5,120,110,102.5,85,121.25,126,131.25,122.5,100,128.888889,118.333333,82,88.125,103.125,104.375,111.875,90,122.222222,97.5,85.625,86.875,101.666667,104.2857143,104.2857143,105,117,114.444444,125,108.5,101.625,98.75,101.666667,112.777778,106.875,115,113.125,98.3333333,118.75,105.555556,94.375,110,126.111111,105,102,100,97.14285714,150,80,104.444444,113.5714286,106.25,94.375,105,103.75,114.2857143,111.111111,100.555556,92.5,82.1428714,72.5,82.5,80,67.5,62.5,48.75,95,89.375,93.75,113.75,122.5,124.375,118.75,125,119.375,83.8888889,98,105,100.625,100.7142857,107.7777778,109.444444,118.125,98.57142857,84.4444444,107.7777778,118.125,108.75,105.625,110,108.75,114,101.25,80,75,83.75,85.625,70.5555556,68.3333333,68.75,85.5555556,54.375,85,96.6666667,101.875,105,93.75,112.5,102.5,101.875,105,73.3333333,98.75,118.5714286,85.625,88.75,88.125,78.75,98.75,97.5,55,75.5555556,66.875,72.5,83.125,70,69.4444444,61.875,28.75,73.75,96.875,103.125,101.25,96.25,108.125,102.5,101.25,96.875,78.125,98.125,98.125,90,78.125,88.75,97.77777778,78.33333333,83.75,79.5,82.5,88,114.375,119.2857143,96.25,91.25,92.5,82,72.85714286,68.75,68.125,73.125,81.25,70.71428571,58.125,53.75,44.375,64.4444444,85.625,90,78.125,92.5,92.5,87.7777778,88.75,86.42857143,55,64.4444444,71.25,75,64.375,66.875,75.625,60,69.375,44.5,53.75,48.57142857,53,58.75,67.5,63.125,45.625,42.14285714,55.555556,63.75,66.25,71.25,65.625,68.3333333,69.375,72.5,70,62.5,50.625,59.375,57.14285714,57.5,63.125,71,68.75,56.25,42.5,48.75,47.5,55,43.3333333,43.75,45.625,44.375,34.375,45,46.875,40.71426571,47.5,38.125,50,41.875,45,42.5,38.88888889,46.875,44.375,54,55,50,41.875,45,42.5,43.75,45.625,46.25,42.5,40.625,48.125,42.5,42.5,35,38.125,33.75,40,41.875,32.5,31.25,37,36.25,33.88888889,58.125,52.7777778,58.125,60,61.875,68.125,61.875,63.125,60.625,54.16666667,62.22222222,50,56.875,47.72727273,48.75,51.25,47.5,35.625,59.4444444,63.75,73.125,68.75,57.5,64.4444444,63.175,72.5,71.1111111,41.25,46.25,48.57142857,46.875,37.7777778,40.5555556,35,38.5,31.875,53.75,51.25,62.5,59.375,54.375,66.25,58.125,66.875,60,44.375,56.6666667,58.75,49.375,60,55,60,58.75,57.5,41.875,51.875,45.625,46.875,45,43.75,40.625,40.625,36.25,65,83.125,68.125,80,70,83.125,76.875,71.25,73.75,56.25,57.7777778,65,51.1111111,51.6666667,70,90,52.5,39.16666667,67.5,76.25,71.875,71.25,68.125,83.75,75.625,57.5,72.5,51.6666667,55,56.11111111,56.875,51.42857143,41.875,40,39.375,36.875,58,78.57142857,100.625,97.5,96.25,88.125,92.5,103.3333333,90,55.625,70,66.1111111,63.125,60,67.5,63.75,66.25,71.25,46.1111111,55.625,50.625,55,47.5,47.5,46.25,47.2222222,38.125,58.125,76.25,93.8888889,88.75,109.375,104.4444444,89.28571429,93.75,93.57142857,65.625,64.375,66.25,59.375,60.625,54.375,55.625,52.5,42.5,61.875,77.2222222,80.625,77.85714286,77.5,85,73.75,76.25,76.25,53.125,48.75,48.75,50.625,40.5555556,46.875,41.875,43.125,38.125,65.625,65,68.75,59.375,58.75,56.875,67.2222222,60.71428571,65,52.5,63.125,65.625,60.71428571,62.2222222,61.42857143,58.75,58.125,54.4444444,77.5,56.875,55,53.125,49.375,58.57142857,48.75,46.25,41.25,62.5,92.22222222,95,113.125,94.4444444,123.125,113.75,98.75,113.5714286,67.5,77.85714286,101.25,69.375,78.57142857,95,65.625,60,64.4444444,100.625,101.25,98.75,106.875,76.42857143,82.5,76.25,82.5,81.25]
hourly_data=numpy.array(hourly_data).reshape(num_days,num_hour)

## Making three hours ahead predictions
hourly_data_15=pandas.DataFrame(hourly_data[:,5])
hourly_data_15.columns=["Hour15"]
hourly_data_12=pandas.DataFrame(hourly_data[:,2])
hourly_data_12.columns=["Hour12"]

# Reading other variables
df=pandas.read_csv("metadata.csv",sep=',',header=0)
df["DAYOFWEEK"]=df["DAYOFWEEK"].astype("category")
df["HOLIDAYM"]=df["HOLIDAYM"].astype("category")
df["WDWTICKETSEASON"]=df["WDWTICKETSEASON"].astype("category")
df["WDWevent"]=df["WDWevent"].astype("category")
df["MKevent"]=df["MKevent"].astype("category")
df["inSession"]=df["inSession"].str.rstrip('%').astype('float')



df=pandas.concat((hourly_data_15,hourly_data_12,df),axis=1)
df.index=pandas.to_datetime(df["DATE"])
df.drop(columns=["DATE"])


res = sm.tsa.adfuller(df['Hour15'].dropna(),regression='ct')
print('p-value:{}'.format(res[1]))

df.to_csv(r'df.csv', index = False, header=True)